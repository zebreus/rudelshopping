<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rudelshopping</title>
    <style>
      @font-face {
        font-family: krypton;
        src: url(./fonts/MonaspaceKrypton-Regular.woff2);
      }

      body {
        margin: 0;
        padding: 0;
        background-color: #333;
        color: #f7a8b8;
        /* Pink color for text */
        font-size: 18px;
        font-family: krypton;
        /* Adjust the font size as needed */
      }

      .pride-flag {
        display: flex;
        height: 20px;
      }

      .pride-flag div {
        flex: 1;
      }

      .pride-flag .red {
        background-color: #ff0000;
      }

      .pride-flag .orange {
        background-color: #ff8c00;
      }

      .pride-flag .yellow {
        background-color: #ffff00;
      }

      .pride-flag .green {
        background-color: #008000;
      }

      .pride-flag .blue {
        background-color: #0000ff;
      }

      .pride-flag .purple {
        background-color: #800080;
      }

      header {
        background-color: #333;
        color: #f7a8b8;
        /* Pink color for header text */
        padding: 1rem 0;
        text-align: center;
      }

      nav {
        display: block;
        background-color: #555;
      }

      .container {
        padding: 2rem;
      }

      a {
        color: #55cdfc;
        /* Light blue color for links */
      }

      #order-form {
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }

      fieldset {
        margin-bottom: 1rem;
        display: flex;
        justify-content: flex-end;
        flex-direction: column;
      }
    </style>
  </head>

  <body>
    <!-- <script>
        // Function to inject CSS into a shadow DOM
        function injectCssToShadow(shadowRoot, css) {
            const style = document.createElement('style');
            style.textContent = css;
            shadowRoot.appendChild(style);
        }

        // Function to observe changes in the DOM
        function observeStripeButton() {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === Node.ELEMENT_NODE && node.tagName === 'STRIPE-BUY-BUTTON') {
                            // Check if shadowRoot exists and inject CSS
                            console.log("Found", node)
                            if (node.shadowRoot) {
                                injectCssToShadow(node.shadowRoot, `
                            button {
                                background-color: #4CAF50 !important; /* Example custom styling */
                                color: white !important;
                                font-size: 16px !important;
                            }
                        `);
                            }
                        }
                    });
                });
            });

            // Start observing the body for added Stripe buttons
            observer.observe(document.body, { childList: true, subtree: true });
        }

        // Call the observer function
        observeStripeButton();
    </script> -->
    <div class="pride-flag">
      <div class="red"></div>
      <div class="orange"></div>
      <div class="yellow"></div>
      <div class="green"></div>
      <div class="blue"></div>
      <div class="purple"></div>
    </div>
    <div class="trans-flag">
      <div class="blue"></div>
      <div class="pink"></div>
      <div class="white"></div>
      <div class="pink"></div>
      <div class="blue"></div>
    </div>
    <header>
      <h1>Rudelblinken Webshop</h1>
    </header>

    <div class="container">
      <p>
        Here you can preorder the brand new
        <a href="https://oshwlab.com/zebreus/rudelblinken"
        >Rudelblinken Delta</a>, the best RGB* Catears ever made!
      </p>
      <p>
        We will be ordering the next batch around late february. Production
        costs are expected to be around 4€ per board. 6€ for the full kit
        including 3d printed cat-ears and a randomly colored LED strip.
      </p>
      <p>
        To keep updated on the current status join the <a
          href="https://matrix.to/#/#rudelblinken:zebre.us"
        >Rudelblinken matrix room</a>
      </p>
      <form id="order-form" action="/submit-order" method="post">
        <h2>Order Form</h2>

        <fieldset>
          <legend>Products</legend>

          <fieldset>
            <legend>PCB Only</legend>
            <label>
              Quantity <input
                type="number"
                id="pcbOnlyQuantity"
                name="pcbOnlyQuantity"
                min="0"
                step="1"
                max="999"
                placeholder="0"
              />
            </label>

            <label>Price<input
                type="number"
                id="pcbOnlyPrice"
                name="pcbOnlyPrice"
                min="4"
                step="0.01"
                placeholder="7"
                value="7"
              /> (Suggested Price: 7€, Minimum: 4€)</label>
          </fieldset>

          <fieldset>
            <legend>Full kit</legend>
            <label>
              Quantity <input
                type="number"
                id="fullKitQuantity"
                name="fullKitQuantity"
                min="0"
                step="1"
                max="999"
                placeholder="0"
              />
            </label>

            <label>Price
              <input
                type="number"
                id="fullKitPrice"
                name="fullKitPrice"
                min="4"
                step="0.01"
                placeholder="9"
                value="9"
              /> (Suggested Price: 9€, Minimum: 6€)</label>
          </fieldset>
        </fieldset>

        <fieldset>
          <legend>Delivery</legend>

          <p>
            We offer shipping and pickup at various events. Shipping is 4.20€
            and pickup is free. Pickup is possible at W17 hackspace, Easterhegg
            and GPN. If you want me to ship to you, please make sure to provide
            a valid email address so I can send you a tracking link.
          </p>

          <label>
            <input
              id="shippingRadio"
              type="radio"
              name="deliveryMethod"
              value="shipping"
              checked
              required
            />
            Shipping (4.20€)
          </label>

          <label>
            <input
              id="w17Radio"
              type="radio"
              name="deliveryMethod"
              value="w17"
              required
            />
            Pickup at W17 hackspace (0€)
          </label>
          <label>
            <input
              id="easterheggRadio"
              type="radio"
              name="deliveryMethod"
              value="easterhegg"
              required
            />
            Pickup at Easterhegg (0€)
          </label>
          <label>
            <input
              id="gpnRadio"
              type="radio"
              name="deliveryMethod"
              value="gpn"
              required
            />
            Pickup at GPN (0€)
          </label>
        </fieldset>

        <fieldset>
          <legend>Payment</legend>

          <label>
            <input
              id="noCashRadio"
              type="radio"
              name="paymentMethod"
              value="stripe"
              checked
              required
            />
            Online Payment
          </label>

          <label>
            <input
              id="cashRadio"
              type="radio"
              name="paymentMethod"
              value="cash"
              required
            />
            Cash (Only for pickup orders)
          </label>
        </fieldset>

        <fieldset>
          <legend>Information</legend>

          <label>
            Your name
            <input
              type="text"
              name="name"
              id="name"
              placeholder="xX_H4x0r_1337_Xx"
              required
            >
          </label>

          <label>
            Your email address (I will send a tracking link when I shipped your
            order)
            <input
              type="email"
              name="email"
              id="email"
              placeholder="creature@example.com"
              required
            >
          </label>

          <label>
            Notes
            <textarea
              name="notes"
              id="notes"
              placeholder="If you want to tell me anything else, write it here."
            >
            </textarea>
          </label>
        </fieldset>

        <button type="submit">Preorder now</button>
      </form>

      <script>
        // Form validation

        const pcbOnlyQuantity = document.getElementById(
          "pcbOnlyQuantity",
        );
        const pcbOnlyPrice = document.getElementById(
          "pcbOnlyPrice",
        );
        const fullKitQuantity = document.getElementById(
          "fullKitQuantity",
        );
        const fullKitPrice = document.getElementById(
          "fullKitPrice",
        );
        const notes = document.getElementById("notes");
        const email = document.getElementById("email");
        const name = document.getElementById("name");
        const cashRadio = document.getElementById("cashRadio");
        const noCashRadio = document.getElementById("noCashRadio");
        const shippingRadio = document.getElementById(
          "shippingRadio",
        );
        const w17Radio = document.getElementById("w17Radio");
        const easterheggRadio = document.getElementById(
          "easterheggRadio",
        );
        const gpnRadio = document.getElementById("gpnRadio");

        // Assert a valid email
        email.addEventListener("input", (event) => {
          if (email.validity.typeMismatch) {
            email.setCustomValidity(
              "I am expecting an email address!",
            );
          } else {
            email.setCustomValidity("");
          }
        });

        // Assert that more than 1 item is ordered
        const checkQuantity = () => {
          const pcbOnly = pcbOnlyQuantity.value || 0;
          const fullKit = fullKitQuantity.value || 0;
          const orderQuantity = parseInt(pcbOnly) + parseInt(fullKit);
          if (orderQuantity <= 0) {
            pcbOnlyQuantity.setCustomValidity(
              "You need to order at least one item",
            );
            fullKitQuantity.setCustomValidity(
              "You need to order at least one item",
            );
          } else {
            pcbOnlyQuantity.setCustomValidity("");
            fullKitQuantity.setCustomValidity("");
          }
        };
        pcbOnlyQuantity.addEventListener("input", checkQuantity);
        fullKitQuantity.addEventListener("input", checkQuantity);
        checkQuantity();

        // Assert that cash is only selected for pickup
        const checkPaymentMethod = () => {
          if (cashRadio.checked && shippingRadio.checked) {
            cashRadio.setCustomValidity(
              "You can only pay cash if you pick up your order",
            );
            shippingRadio.setCustomValidity(
              "Shipping is only possible with online payment",
            );
          } else {
            cashRadio.setCustomValidity("");
            shippingRadio.setCustomValidity("");
          }
        };
        cashRadio.addEventListener("input", checkPaymentMethod);
        noCashRadio.addEventListener("input", checkPaymentMethod);
        shippingRadio.addEventListener("input", checkPaymentMethod);
        w17Radio.addEventListener("input", checkPaymentMethod);
        easterheggRadio.addEventListener("input", checkPaymentMethod);
        gpnRadio.addEventListener("input", checkPaymentMethod);
        checkPaymentMethod();

        const checkPcbOnlyPrice = (event) => {
          const pcbOnlyQuant = pcbOnlyQuantity.value || 0;
          if (
            parseFloat(pcbOnlyPrice.value) < 4 && pcbOnlyQuant > 0
          ) {
            pcbOnlyPrice.setCustomValidity(
              "Please enter a price that is higher than the production cost (4€). If that doesn't work for you, write me an email.",
            );
          } else {
            pcbOnlyPrice.setCustomValidity("");
          }
        };
        pcbOnlyPrice.addEventListener("input", checkPcbOnlyPrice);
        checkPcbOnlyPrice();

        const checkFullKitPrice = (event) => {
          const fullKitQuant = fullKitQuantity.value || 0;
          if (
            parseFloat(fullKitPrice.value) < 6 && fullKitQuant > 0
          ) {
            fullKitPrice.setCustomValidity(
              "Please enter a price that is higher than the production cost (4€). If that doesn't work for you, write me an email.",
            );
          } else {
            fullKitPrice.setCustomValidity("");
          }
        };
        fullKitPrice.addEventListener("input", checkFullKitPrice);
        checkFullKitPrice();
      </script>

      <p>
        RGB stands for Really Good Blinkenlights. We also offer them in a
        variety of colors, but a single rudelblinken is just a single color.
      </p>
    </div>
  </body>
</html>
